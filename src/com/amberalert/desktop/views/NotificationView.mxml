<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/halo" width="100%" height="100%">

	<s:layout><s:VerticalLayout/></s:layout>


	<fx:Script>
		<![CDATA[
			import com.amberalert.desktop.models.AMBERAlert;
			import com.amberalert.desktop.models.Location;
			import com.amberalert.desktop.models.Person;
			import com.amberalert.desktop.models.Vehicle;
			

			private var index:int;
			private var _currentAlert:AMBERAlert;
			[Bindable] private var _currentSuspect:Person = new Person();
			[Bindable] private var _currentVictim:Person = new Person();
			[Bindable] private var _currentLocation:Location = new Location();
			[Bindable] private var _currentVehicle:Vehicle = new Vehicle();
			[Bindable] private var googleMapLink:String;

			
			import flash.events.Event;
			import flash.events.MouseEvent;

			public function set currentAlert(value:AMBERAlert):void
			{
				if(value != null)
				{
					index = 0;
					_currentAlert = value;
					//When an alert is set set all these variables so it's easier to bind them to the view
					//TODO reset all indexes and use indexes instead of finite number 0 to implement multiple suspect,victims,vehicles,and locations views
					_currentSuspect = value.suspects.getItemAt(index) as Person;
					_currentVictim = value.victims.getItemAt(index) as Person;
					_currentLocation = value.locations.getItemAt(index) as Location;
					_currentVehicle = value.vehicles.getItemAt(index) as Vehicle;
					googleMapLink = "http://maps.google.com/maps/api/staticmap?center=" + _currentLocation.lastSeenLat + "," + _currentLocation.lastSeenLon + "&zoom=13&size=200x200&sensor=false";	
				}
				else
				{
					_currentAlert = new AMBERAlert();
					_currentSuspect = new Person();
					_currentVictim = new Person();
					_currentLocation = new Location();
					_currentVehicle = new Vehicle();
				}
			}
			
			
			protected function image1_clickHandler(event:MouseEvent):void
			{
				//URL to the alert is constructed and opened in new tab
				var req:URLRequest = new URLRequest('http://amberalert.com/' + _currentAlert.uid);
				navigateToURL(req, "_blank");
			}

			
			protected function nextAlert():void
			{
				//TODO dispatch an event to be routed to glue and then routed to alertscontroller
				//if (index < alertCount - 1)
				//	index++;
				//else
				//	index = 0;
			}
			
			protected function prevAlert():void
			{
				//TODO dispatch an event to be routed to glue and then routed to alertscontroller
				//if (index > 0)
				//	index--;
				//else
				//	index = alertCount - 1;
			}
		]]>
	</fx:Script>
	

	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<s:Label  text="AMBER Alert"/>
	<s:Group>
		<s:layout><s:HorizontalLayout/></s:layout>
		<s:Group>
			<s:layout><s:VerticalLayout/></s:layout>
			<s:Label  text="Victim"/>
			<mx:Image  width="200" height="200" click= "image1_clickHandler(event)" source="{_currentVictim.picture}"/>
			<mx:Form>			
				<mx:FormItem label = "Name:">
					<s:Label  text= "{_currentVictim.name}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Gender:">
					<s:Label  text="{_currentVictim.gender}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Age:">
					<s:Label  text="{_currentVictim.age}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Height:">
					<s:Label  text="{_currentVictim.height}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Weight:">
					<s:Label  text="{_currentVictim.weight}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Hair:">
					<s:Label  text="{_currentVictim.hair}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Eyes:">
					<s:Label  text="{_currentVictim.eyes}"/>			
				</mx:FormItem>
			</mx:Form>			
		</s:Group>		
		<s:Group>
			<s:layout><s:VerticalLayout/></s:layout>
			<s:Label  text="Suspect"/>
			<mx:Image  width="200" height="200" click= "image1_clickHandler(event)" source="{_currentSuspect.picture}"/>
			<mx:Form>				
				<mx:FormItem label = "Name:">
					<s:Label  text="{_currentSuspect.name}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Gender:">
					<s:Label  text="{_currentSuspect.gender}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Age:">
					<s:Label  text="{_currentSuspect.age}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Height:">
					<s:Label  text="{_currentSuspect.height}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Weight:">
					<s:Label  text="{_currentSuspect.weight}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Hair:">
					<s:Label  text="{_currentSuspect.hair}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Eyes:">
					<s:Label  text="{_currentSuspect.eyes}"/>			
				</mx:FormItem>
			</mx:Form>			
		</s:Group>	
		<s:Group>
			<s:layout><s:VerticalLayout/></s:layout>
			<s:Label  text="Vehicle"/>
			<mx:Image  width="200" height="200" click= "image1_clickHandler(event)" source="{_currentVehicle.picture}"/>
			<mx:Form>
				
				<mx:FormItem label = "Make:">
					<s:Label  text="{_currentVehicle.make}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Model:">
					<s:Label  text="{_currentVehicle.model}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Year:">
					<s:Label  text="{_currentVehicle.year}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Plate:">
					<s:Label  text="{_currentVehicle.plate}"/>			
				</mx:FormItem>
				<mx:FormItem label = "Color:">
					<s:Label  text="{_currentVehicle.color}"/>			
				</mx:FormItem>
			</mx:Form>			
		</s:Group>	
		<s:Group>
			<s:layout><s:VerticalLayout/></s:layout>
			<s:Label  text="Location"/>
			<mx:Image  id="mapImage" width="200" height="200" source="{googleMapLink}" click= "image1_clickHandler(event)" />
			<mx:Form>				
				<mx:FormItem label = "City:">
					<s:Label  text="{_currentLocation.city}"/>			
				</mx:FormItem>
				<mx:FormItem label = "State:">
					<s:Label  text="{_currentLocation.province}"/>			
				</mx:FormItem>
			</mx:Form>			
		</s:Group>
	</s:Group>
	<s:Group>
		<s:layout><s:HorizontalLayout/></s:layout>
		<mx:Button label="Prev" click= "prevAlert()"/>
		<mx:Button label="Next" click= "nextAlert()"/>
	</s:Group>
</s:Group>

